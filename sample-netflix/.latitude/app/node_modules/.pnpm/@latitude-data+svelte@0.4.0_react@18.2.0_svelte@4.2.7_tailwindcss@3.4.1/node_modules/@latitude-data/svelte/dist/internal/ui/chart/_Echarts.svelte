<script context="module"></script>

<script>import { debounce } from "lodash-es";
import * as echarts from "echarts/core";
import { CanvasRenderer } from "echarts/renderers";
import {
  GridComponent,
  TooltipComponent,
  TitleComponent,
  LegendComponent,
  DatasetComponent,
  TransformComponent,
  DataZoomComponent,
  AriaComponent
} from "echarts/components";
import {
  LineChart,
  BarChart,
  ScatterChart,
  PieChart,
  FunnelChart,
  GaugeChart
} from "echarts/charts";
import { theme as client } from "@latitude-data/client";
echarts.use([
  // Charts
  LineChart,
  BarChart,
  PieChart,
  FunnelChart,
  ScatterChart,
  GaugeChart,
  // Core components
  AriaComponent,
  TitleComponent,
  LegendComponent,
  TooltipComponent,
  GridComponent,
  DatasetComponent,
  TransformComponent,
  DataZoomComponent,
  CanvasRenderer
]);
const theme = client.ui.chart.THEMES.latitude;
export let options;
export let width = void 0;
export let height = void 0;
export let locale = void 0;
export function chartable(element, { options: options2, theme: theme2, locale: locale2 }) {
  let resizeObserver;
  const echartsInstance = echarts.init(element, theme2, {
    renderer: "canvas",
    locale: locale2 ?? "en"
  });
  echartsInstance.setOption(options2);
  const onWindowResize = debounce(() => {
    echartsInstance.resize({
      animation: {
        duration: options2.animation ? 400 : 0
      }
    });
  }, 100);
  if (window.ResizeObserver && element) {
    resizeObserver = new ResizeObserver(onWindowResize);
    resizeObserver.observe(element);
  } else {
    window.addEventListener("resize", onWindowResize);
  }
  onWindowResize();
  return {
    update({ options: newOptions }) {
      echartsInstance.setOption({ ...options2, ...newOptions });
    },
    destroy() {
      if (resizeObserver) {
        resizeObserver.unobserve(element);
      } else {
        window.removeEventListener("resize", onWindowResize);
      }
      echartsInstance.dispose();
    }
  };
}
</script>

<div class="h-full w-full">
  {#if options}
    <div
      use:chartable={{ theme, options, locale }}
      class="min-h-full min-w-full"
      style="width: {width}px; height: {height}px"
    />
  {/if}
</div>
